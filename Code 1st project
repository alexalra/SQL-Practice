--Business Question:

-- 1) Who are the top 5 artists whose tracks occupy more bytes in this database? 

SELECT 
  A.name, 
  SUM(T.bytes) AS TOTAL_BYTES
FROM 
  artist as A
JOIN 
  album as AL 
ON 
  A.ArtistId=AL.ArtistId
JOIN 
  track as T
ON 
  T.AlbumID=AL.AlbumID
GROUP BY 
  A.name
ORDER BY 
  TOTAL_BYTES DESC
LIMIT
  5

-- 2) Who is the employe who generate more profits?

SELECT 
  SUM(I.total) TOTAL_SALES, 
  E.EmployeeId, 
  E.FirstName, 
  E.LastName
FROM 
  Invoice AS I
JOIN 
  Customer as C
ON 
  C.CustomerId = I.CustomerId
JOIN 
  Employee as E
ON 
  C.SupportRepId = E.EmployeeId
GROUP BY 
  E.EmployeeId
ORDER 
  BY TOTAL_SALES DESC
LIMIT
  1

-- 3) What is the average duration of the tracks sold by the employee with higher sales?


WITH TABLE_1 AS (SELECT 
  SUM(I.total) TOTAL_SALES, 
  E.EmployeeId, 
  E.FirstName NAAME, 
  E.LastName
FROM 
  Invoice AS I
JOIN 
  Customer as C
ON 
  C.CustomerId = I.CustomerId
JOIN 
  Employee as E
ON 
  C.SupportRepId = E.EmployeeId
GROUP BY 
  E.EmployeeId
ORDER 
  BY TOTAL_SALES DESC
LIMIT 
1
),

TABLE_2 AS 
(SELECT T.TrackId, AVG(T.Milliseconds) AVERAGE_DURATION, E.FirstName NAAAME
FROM TRACK as T
JOIN InvoiceLine as IL 
ON T.TrackId = IL.TrackId
JOIN Invoice as I
ON IL.InvoiceId = I.InvoiceId
JOIN Customer as C
ON C.CustomerId = I.CustomerId
JOIN Employee as E
ON C.SupportRepId = E.EmployeeId
GROUP BY E.FirstName)


SELECT  TABLE_1.NAAME, TABLE_2.AVERAGE_DURATION
FROM TABLE_1
JOIN TABLE_2
ON TABLE_1.NAAME = TABLE_2.NAAAME 



