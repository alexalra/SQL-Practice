# SQL-Practice - 1st project

This project will explore multiple questions with regard to the database Chinook.db, which represents a digital media store. 

The database was retrieved from [Kaggle](https://www.kaggle.com/datasets/marwandiab/chinookdatabase). 

The Entity Relation Diagram for the Database is available in the next file [README ERD.md](https://github.com/alexalra/SQL-Practice/blob/main/2.%20README%20ERD.md)

I explored the data in this database by asking questions related to the company's sales, HR-related or even about the use of data space. You can explore the following pages to see the questions I posed and the answered I obtained. 

- [README Sales Questions](https://github.com/alexalra/SQL-Practice/blob/main/3.%20README%20Sales%20Questions)
- XXXX
- XXXX

The SQL code written for answering said questions is available in

- XXXXX for XXXXX
- XXXXX for XXXXX
- XXXXX for XXXXX

file [Code 1st project](https://github.com/alexalra/SQL-Practice/blob/main/1.%20README%20Project%20introduction.md). I aimed at using all different features SQL offers to solve plausible questions that could come up in regular business scenarios. 


  

-- 3) What is the average duration of the tracks sold by the employee with higher sales?

To answer this question I created 2 subquerries, that I merged at the end into 1 single table.

The first subquerry (TABLE_1) returned the employee with higher sales.
The second subquerry (TABLE_2) returned the average duration of the tracks sold by every employee.

In the last section of the querry, I joined these 2 on the employee name, to see the average duration of the tracks sold by the employee with higher sales. 


```ruby
WITH TABLE_1 AS 

  (SELECT 
    E.FirstName NAME, 
    E.LastName LAST_NAME,
    SUM(I.total) TOTAL_SALES, 
    E.EmployeeId EMPLOYEE_ID 
  FROM 
    Invoice AS I
  JOIN 
    Customer as C
  ON 
    C.CustomerId = I.CustomerId
  JOIN 
    Employee as E
  ON 
    C.SupportRepId = E.EmployeeId
  GROUP BY 
    4
  ORDER 
    BY 3 DESC
  LIMIT 
    1),

TABLE_2 AS 

  (SELECT 
    AVG(T.Milliseconds) AVERAGE_DURATION, 
    E.FirstName NAME,
    E.LastName LAST_NAME
  FROM 
    TRACK as T
  JOIN 
    InvoiceLine as IL 
  ON 
    T.TrackId = IL.TrackId
  JOIN 
    Invoice as I
  ON 
    IL.InvoiceId = I.InvoiceId
  JOIN 
    Customer as C
  ON 
    C.CustomerId = I.CustomerId
  JOIN 
    Employee as E
  ON 
    C.SupportRepId = E.EmployeeId
  GROUP BY 
    2)

SELECT  
  TABLE_1.NAME, 
  TABLE_1.LAST_NAME,
  TABLE_2.AVERAGE_DURATION
FROM 
  TABLE_1
JOIN 
  TABLE_2
ON 
  TABLE_1.NAME = TABLE_2.NAME AND  
  TABLE_1.LAST_NAME =  TABLE_2.LAST_NAME
```

![image](https://github.com/alexalra/SQL-Practice/assets/78654579/d2b420a4-ea96-40ed-b27d-97d403ab1bb7)


